<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Article</title>

<!-- Contentful UMD & Rich Text renderer -->
<script src="https://cdn.jsdelivr.net/npm/contentful@latest/dist/contentful.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@contentful/rich-text-html-renderer@16.0.4/dist/rich-text-html-renderer.umd.js"></script>

<style>
  body { font-family: Inter, system-ui, sans-serif; background:#f7f9fc; padding:2rem; }
  .container { max-width:900px; margin:0 auto; background:#fff; border-radius:12px; padding:28px; box-shadow:0 8px 30px rgba(0,0,0,0.06); }
  .post-title { font-size:2rem; margin:0 0 8px; }
  .post-date { color:#666; margin-bottom:14px; }
  .post-image { width:100%; max-height:420px; object-fit:cover; border-radius:8px; margin-bottom:14px; }
  .post-content img { max-width:100%; height:auto; border-radius:6px; }
  .back { display:inline-block; margin-bottom:14px; color:#1565c0; text-decoration:none; }
</style>
</head>
<body>
  <div class="container" id="post">Loadingâ€¦</div>

  <script>
    const client = contentful.createClient({
      space: '4l890vk1ti4c',
      accessToken: 'bPbgjAoOo6pmJT3DTI82TSry6MQh8zwuHEbi9VtVkmA'
    });

    const params = new URLSearchParams(window.location.search);
    const postId = params.get('id');

    async function fetchPost() {
        const postContainer = document.getElementById('post');

        if (!postId) {
            postContainer.innerHTML = "<p>No article ID provided.</p>";
            return;
        }

        try {
            const entry = await client.getEntry(postId);
            if (!entry || !entry.fields) {
            postContainer.innerHTML = "<p>Article not found.</p>";
            return;
            }

            const title = entry.fields.title || "(No title)";
            const dateTime = entry.fields.dateTime ? new Date(entry.fields.dateTime).toDateString() : "";
            const imageUrl = entry.fields.image ? "https:" + entry.fields.image.fields.file.url : "";
            
            // Safe Rich Text rendering
            let postHtml = "";
            if (entry.fields.post && entry.fields.post.content) {
            postHtml = window.contentfulRichTextHtmlRenderer.documentToHtmlString(entry.fields.post);
            }

            postContainer.innerHTML = `
            <a class="back" href="articles.html">&larr; Back to Articles</a>
            <h1 class="post-title">${title}</h1>
            <div class="post-date">${dateTime}</div>
            ${imageUrl ? `<img class="post-image" src="${imageUrl}" alt="${title}">` : ""}
            <div class="post-content">${postHtml}</div>
            `;
        } catch (err) {
            console.error(err);
            postContainer.innerHTML = "<p>Error loading article.</p>";
        }
    }

    fetchPost();
    
  </script>
</body>
</html>
